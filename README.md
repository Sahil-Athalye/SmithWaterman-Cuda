# Smith–Waterman CUDA + BAliBASE Evaluation Workflow

This repository contains a complete pipeline for running and evaluating a CUDA‑accelerated Smith–Waterman local alignment against BAliBASE reference alignments.

## File Structure

```
SmithWaterman/
├── bali_score_src/        # BAliBASE scorer sources & Makefile (GCG‐only build)
├── cudaMSFs/              # Test MSF outputs generated by CUDA kernel
├── expat-1.95.2/          # Expat XML parser sources (optional)
├── MSFs/                  # Original BAliBASE multi‐sequence MSF files and split pairwise MSFs
├── Sequences/             # Input FASTA/TFA multi‐sequence files and split pairwise FASTAs
├── generateMSF.py         # Batch-run script: runs CUDA aligner over all FASTA pairs
├── smithWaterman          # Compiled CUDA alignment binary (Smith–Waterman)
├── smithWaterman.cu       # CUDA C++ source implementing Smith–Waterman + MSF output
├── splitMSF.py            # Splits a multi‑sequence MSF into all two‑sequence MSF files
└── splitSequences.py      # Splits `.tfa` multi‑FASTA into individual `.fa` files
```  

## Prerequisites

- **CUDA Toolkit** (nvcc) for building the GPU kernel
- **GCC** (or `cc`) to compile the BAliBASE scorer
- **Python 3** for the utility scripts

## Setup & Build

### 1. Build the CUDA Kernel

```bash
cd SmithWaterman
nvcc -std=c++11 -O2 -arch=sm_60 -o smithWaterman smithWaterman.cu
```

This produces the `smithWaterman` executable that reads two FASTA files and a reference MSF, then writes a full‑length two‑sequence MSF to stdout.

### 2. Compile BAliBASE Scorer (GCG/MSF‑only)

```bash
cd bali_score_src
gcc -std=c99 -O2 -Wall -DGCG -I. \
    -c init.c util.c bali_score.c xmlstub.c
cc -o bali_score init.o util.o bali_score.o xmlstub.o -lm
```

This yields `bali_score`, which scores SP/TC against BAliBASE MSF.

## Data Preparation

1. **Split Sequences**  
   ```bash
   cd SmithWaterman
   python3 splitSequences.py Sequences/
   ```
   Creates `Sequences/pairwise_fasta/<family>/` with per‑protein `.fa` pairs.

2. **Split MSF Reference**  
   ```bash
   python3 splitMSF.py MSFs/
   ```
   Produces `MSFs/pairwise_msf/<family>/` containing two‑seq MSF gold standards.

## Batch Alignment & Scoring

Use `generateMSF.py` to run the CUDA kernel on all FASTA pairs and collect MSFs:

```bash
python3 generateMSF.py \
    Sequences/pairwise_fasta \
    ./smithWaterman \
    cudaMSFs/
```

This mirrors the family subfolders under `cudaMSFs/` and writes one two‑seq MSF per pair.

Finally, score every test alignment against its BAliBASE reference:

```bash
cd bali_score_src
# example for one pair:
./bali_score \
  ../MSFs/pairwise_msf/BB11001/BB11001_1aab___2lef_A.msf \
  ../cudaMSFs/BB11001/BB11001_1aab___2lef_A.msf
```

Or script it across all families by looping over directories.

## Summary

- **smithWaterman.cu**: GPU kernel + full-length MSF output.  
- **bali_score_src/**: GCG‑only BAliBASE SP/TC scorer.  
- **splitSequences.py / splitMSF.py**: data splitting utilities.  
- **generateMSF.py**: orchestration of pairwise alignment and MSF generation.  

With this setup, you can automatically benchmark your CUDA‐accelerated local aligner against BAliBASE gold standards across entire families of sequences. Enjoy!  

